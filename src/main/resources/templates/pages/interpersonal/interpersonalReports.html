<!DOCTYPE html>
<html xml:th="https://www.thymeleaf.org">
<head th:replace="~{components/Header :: head('Analysis')}"></head>
<body class="bg-2 text-1" data-bs-theme="dark">
<div th:replace="~{components/Navigation :: vertical}"></div>
<main class="bg-2 d-flex flex-column flex-fill" style="margin-left: 60px; height: 100vh;">
    <nav class="container-fluid pt-2 border-bottom" style="background: linear-gradient(#222, #2c2c2c);">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <div class="col-md-10 d-flex flex-row align-items-center justify-content-start">
                <img class="square-image me-2" style="height: 40px; width: 40px" alt="Analysis image" th:src="@{/icons/Reports.svg}">
                <h1 class="fw-bold">Polariscope Analysis</h1>
            </div>
            <div class="spinner-border d-none" role="status" id="loading-spinner">
                <span class="visually-hidden">Loading...</span>
            </div>
            <img src="/icons/Error.svg" id="error-icon" alt="error" class="square-image d-none" height="32px" width="32px" />
        </div>
        <div class="mb-0 pb-0 d-flex justify-content-between align-items-end">
            <ul class="nav nav-underline" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active fs-3 p-0" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview-tab-pane" type="button" role="tab" aria-controls="overview-tab-pane" aria-selected="true">Overview</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link fs-3 p-0" id="details-tab" data-bs-toggle="tab" data-bs-target="#details-tab-pane" type="button" role="tab" aria-controls="details-tab-pane" aria-selected="false">Details</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link fs-3 p-0" id="custom-tab" data-bs-toggle="tab" data-bs-target="#custom-tab-pane" type="button" role="tab" aria-controls="custom-tab-pane" aria-selected="false">Custom</button>
                </li>
            </ul>
            <div class="d-flex flex-row align-content-center justify-content-end pb-2 gap-3">
                <div class="mb-2 bg-light-subtle d-flex justify-content-center align-items-center p-2" role="button" onclick="refresh()">
                    <img class="square-image" src="/icons/Plus.svg" alt="New Report" style="width: 20px;">
                </div>
                <div class="mb-2 bg-light-subtle d-flex justify-content-center align-items-center p-2" role="button" onclick="refresh()">
                    <img class="square-image" src="/icons/Refresh.svg" alt="New Report" style="width: 20px;">
                </div>
            </div>
        </div>
    </nav>
    <div class="tab-content container-fluid flex-grow-1">
        <div class="tab-pane fade show active p-2 overflow-y-auto" id="overview-tab-pane" role="tabpanel" aria-labelledby="overview-tab" tabindex="0">
            <div class="pb-2 flex-grow-1 d-flex overflow-x-scroll flex-row gap-3 align-items-center justify-content-start" id="report-selectors"></div>

            <!-- Statistics Table -->
            <h2 class="fw-bold border-bottom mb-2">Quarterly Reports</h2>
            <div id="overview-stats-table" class="table-responsive"></div>
        </div>
        <div class="tab-pane fade h-100" id="details-tab-pane" role="tabpanel" aria-labelledby="details-tab" tabindex="0">
            <div class="row h-100">
                <div class="col-md-8 col-12 p-2">
                    <div class="d-flex flex-md-row flex-column align-items-center gap-2 mb-2" id="details-header"></div>
                    <div class="row mb-2 gx-2" id="detail-chip-container"></div>
                    <h3 class="fw-bold border-bottom mb-2">Events Occurred</h3>
                    <div class="table-responsive" id="detail-event-table"></div>
                </div>
                <div class="col-md-4 d-none d-md-block border-start p-2">
                    <h3 class="p-0 m-0 mb-3 fw-bold">Report Statistics</h3>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="custom-tab-pane" role="tabpanel" aria-labelledby="custom-tab" tabindex="0">...</div>
    </div>
</main>
<div th:replace="~{components/External :: external}"></div>
<div th:replace="~{components/Formatting :: date-formatting}"></div>
<div th:replace="~{components/Network :: network}"></div>
<div th:replace="~{components/Gradient :: gradient}"></div>
<div th:replace="~{components/Network :: data-upload}"></div>
<div th:replace="~{components/Toast :: toast}"></div>
<div th:replace="~{components/External :: tooltips}"></div>

<script>
    let quarterlyReports = [];
    let selectedReport = null;
    let eventList = [];

    refresh();

    function refresh(){
        let spinner = document.querySelector("#loading-spinner");
        let errorIcon = document.querySelector("#error-icon");
        spinner.classList.add("d-block");
        spinner.classList.remove("d-none");

        const quarterlyFetch = fetch("/api/interpersonal/reports/quarterly", {});
        const eventFetch = fetch('/api/interpersonal/event/all')

        Promise.all([quarterlyFetch, eventFetch])
            .then(responses => {
                return Promise.all(responses);
            })
            .then(data => {
                return Promise.all([data[0].json(), data[1].json()]);
            })
            .then(data => {
                console.log(data);

                if(data[0]){
                    quarterlyReports = data[0];
                }

                eventList = data[1];
                renderOverviewTab();
                renderDetailsTab();
            })
            .catch((response) => {
                errorIcon.classList.add("d-block");
                errorIcon.classList.remove("d-none");
                response.json()
                    .then(errorData => {
                        console.log(errorData.message);
                    })
                    .catch(error => {
                        console.error("Error parsing error response:", error);
                    });
            })
            .finally(() => {
                spinner.classList.remove("d-block");
                spinner.classList.add("d-none");
            });


        function renderOverviewTab(){
            renderChips();
            renderOverviewTable();
        }

        function renderDetailsTab(){
            renderOverviewHeader();
            renderDetailChips();
            renderEventTable();
        }

        // Helper functions
        function renderDetailChips(){
            if(quarterlyReports.length < 2){
                return;
            }

            // Get min, max, and median of report standard deviations
            let standardDeviations = quarterlyReports.map(report => report.overallScoreSD).filter(sd => typeof sd === "number");
            standardDeviations.sort((a,b) => a - b);

            let minSd = standardDeviations[0];
            let maxSd = standardDeviations[standardDeviations.length - 1];

            let midSd = Math.floor(standardDeviations.length / 2);
            let medianSd = standardDeviations.length % 2 === 0? (standardDeviations[midSd - 1] + standardDeviations[midSd])/2 : standardDeviations[midSd];

            let hasSd = true;
            if(selectedReport.overallScoreSD === "NaN"){
                hasSd = false;
            }

            // get min, max, and median of report activity scores
            let activityScores = quarterlyReports.map(report => report.newActivityScore);
            activityScores.sort((a,b) => a - b);
            let minAs = activityScores[0];
            let maxAs = activityScores[activityScores.length - 1];

            let midAs = Math.floor(activityScores.length / 2);
            let medianAs = activityScores.length % 2 === 0? (activityScores[midAs - 1] + activityScores[midAs]) / 2 : activityScores[midAs];

            // get min, max, and median of evaluation averages
            let evaluations = quarterlyReports.map(report => report.overallScoreAverage).filter(ev => typeof ev === "number");
            evaluations.sort((a,b) => a - b);
            let minEv = evaluations[0];
            let maxEv = evaluations[evaluations.length - 1];

            let midEv = Math.floor(evaluations.length / 2);
            let medianEv = evaluations.length % 2 === 0? (evaluations[midEv - 1] + evaluations[midEv]) / 2 : evaluations[midEv];

            let hasEv = typeof selectedReport.overallScoreAverage === "number";

            // get min, max, and median of num of events
            let events = quarterlyReports.map(report => report.events);
            events.sort((a,b) => a - b);
            let minEs = events[0];
            let maxEs = events[events.length - 1];

            let midEs = Math.floor(events.length / 2);
            let medianEs = events.length % 2 === 0? (events[midEs - 1] + events[midEs]) / 2 : events[midEs];

            let detailChipHTML = `
                <div class="col-12 col-lg-8">
                    <div class="alert alert-secondary">
                        <div class="d-flex flex-col w-100">
                            <div class="d-flex flex-row align-items-start justify-content-between w-100">
                                <h6 class="text-center fw-bold">Score Mean SD</h6>
                                <p class="text-end fs-2 mb-0" style="margin-top: -10px">${hasSd? selectedReport.overallScoreSD.toFixed(3) : "N/A"}</p>
                            </div>
                        </div>
                        <div class="w-100 position-relative">
                            <img src="/icons/Arrow.svg" class="square-image position-absolute" style="width: 15px; transform: translate(-50%, 0%); left: ${hasSd? selectedReport.overallScoreSD/2 + 50 : 0}%" alt="arrow" />
                        </div>
                        <div class="bg-secondary w-100 mt-4" style="height: 10px;"></div>
                        <div class="w-100 position-relative">
                            <p class="text-muted position-absolute m-0" style="font-size: 10px; transform: translate(-50%, 0%); left: 0">${minSd.toFixed(1)}</p>
                            <p class="text-muted position-absolute m-0" style="font-size: 10px; transform: translate(-50%, 0%); left: 50%">${medianSd.toFixed(1)}</p>
                            <p class="text-muted position-absolute m-0" style="font-size: 10px; transform: translate(-50%, 0%); left: 100%">${maxSd.toFixed(1)}</p>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-4">
                    <div class="alert alert-secondary">
                        <div class="d-flex flex-col w-100">
                            <div class="d-flex flex-row align-items-start justify-content-between w-100">
                                <h6 class="text-center fw-bold">Activity Score</h6>
                                <p class="text-end fs-2 mb-0" style="margin-top: -10px">${selectedReport.newActivityScore}</p>
                            </div>
                        </div>
                        <div class="w-100 position-relative">
                            <img src="/icons/Arrow.svg" class="square-image position-absolute" style="width: 15px; transform: translate(-50%, 0%); left: ${selectedReport.newActivityScore/2 + 50}%" alt="arrow" />
                        </div>
                        <div class="bg-secondary w-100 mt-4" style="height: 10px;"></div>
                        <div class="w-100 position-relative">
                            <p class="text-muted position-absolute m-0" style="font-size: 10px; transform: translate(-50%, 0%); left: 0">${minAs.toFixed(1)}</p>
                            <p class="text-muted position-absolute m-0" style="font-size: 10px; transform: translate(-50%, 0%); left: 50%">${medianAs.toFixed(1)}</p>
                            <p class="text-muted position-absolute m-0" style="font-size: 10px; transform: translate(-50%, 0%); left: 100%">${maxAs.toFixed(1)}</p>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-4">
                    <div class="alert alert-secondary">
                        <div class="d-flex flex-col w-100">
                            <div class="d-flex flex-row align-items-start justify-content-between w-100">
                                <h6 class="text-center fw-bold">Events</h6>
                                <p class="text-end fs-2 mb-0" style="margin-top: -10px">${selectedReport.events}</p>
                            </div>
                        </div>
                        <div class="w-100 position-relative">
                            <img src="/icons/Arrow.svg" class="square-image position-absolute" style="width: 15px; transform: translate(-50%, 0%); left: ${selectedReport.events/2 + 50}%" alt="arrow" />
                        </div>
                        <div class="bg-secondary w-100 mt-4" style="height: 10px;"></div>
                        <div class="w-100 position-relative">
                            <p class="text-muted position-absolute m-0" style="font-size: 10px; transform: translate(-50%, 0%); left: 0">${minEs}</p>
                            <p class="text-muted position-absolute m-0" style="font-size: 10px; transform: translate(-50%, 0%); left: 50%">${medianEs}</p>
                            <p class="text-muted position-absolute m-0" style="font-size: 10px; transform: translate(-50%, 0%); left: 100%">${maxEs}</p>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-8">
                    <div class="alert alert-secondary">
                        <div class="d-flex flex-col w-100">
                            <div class="d-flex flex-row align-items-start justify-content-between w-100">
                                <h6 class="text-center fw-bold">Mean Evaluation</h6>
                                <p class="text-end fs-2 mb-0" style="margin-top: -10px">${hasEv? selectedReport.overallScoreAverage : "N/A"}</p>
                            </div>
                        </div>
                        <div class="w-100 position-relative">
                            <img src="/icons/Arrow.svg" class="square-image position-absolute" style="width: 15px; transform: translate(-50%, 0%); left: ${selectedReport.overallScoreAverage/2 + 50}%" alt="arrow" />
                        </div>
                        <div class="bg-secondary w-100 mt-4" style="height: 10px;"></div>
                        <div class="w-100 position-relative">
                            <p class="text-muted position-absolute m-0" style="font-size: 10px; transform: translate(-50%, 0%); left: 0">${minEv.toFixed(1)}</p>
                            <p class="text-muted position-absolute m-0" style="font-size: 10px; transform: translate(-50%, 0%); left: 50%">${medianEv.toFixed(1)}</p>
                            <p class="text-muted position-absolute m-0" style="font-size: 10px; transform: translate(-50%, 0%); left: 100%">${maxEv.toFixed(1)}</p>
                        </div>
                    </div>
                </div>`;

            document.querySelector("#detail-chip-container").innerHTML = detailChipHTML;
        }

        function renderEventTable(){
            let tableContent = "";
            eventList.forEach(event => {
                tableContent += event.title;
            });

            document.querySelector("#detail-event-table").innerHTML = tableContent;
        }

        function renderOverviewHeader(){
            // Select first report by default
            let headerContent = "";
            if(quarterlyReports.length > 0){
                if(selectedReport == null){
                    selectedReport = quarterlyReports[0];
                }

                let reportList = "";

                quarterlyReports.forEach((report, index) => {
                    reportList += `<option value="${index}">${formatDate(report.startDate)} - ${formatDate(report.endDate)}</option>`
                });

                headerContent = `
                    <h3 class="mb-0 me-auto text-nowrap text-md-start text-center w-100 fw-bold">${formatDate(selectedReport.startDate)} - ${formatDate(selectedReport.endDate)}</h3>
                    <select class="form-select w-auto" aria-label="Default select example">
                        <option selected>Select Report</option>
                        ${reportList}
                    </select>
                `;
            }
            document.getElementById("details-header").innerHTML = headerContent;
        }

        function renderChips(){
            let buttonHTML = "";
            quarterlyReports.forEach((report, index) => {
                buttonHTML += `<button type="button" class="btn btn-secondary text-nowrap" id="report-button-${index}">${formatDate(report.startDate)} - ${formatDate(report.endDate)}</button>`;
            });
            document.querySelector("#report-selectors").innerHTML = buttonHTML;
        }

        function renderOverviewTable(){
            // Top row
            let header = ""
            quarterlyReports.forEach((report, index) => {
                header += `
                <th>
                    <div>
                        <p class="m-0 p-0">${formatDate(report.startDate + " PST")} -</p>
                        <p class="m-0 p-0">${formatDate(report.endDate + " PST")}</p>
                    </div>
                </th>
                `;
            });

            // New Activity Score
            let newActivityScoreRow = ""
            quarterlyReports.forEach((report, index) => {
                newActivityScoreRow += `
                    <td>${report.newActivityScore}</td>
                `;
            });

            // Total Activity Score
            let activityScoreRow = ""
            quarterlyReports.forEach((report, index) => {
                activityScoreRow += `
                    <td>${report.activityScore}</td>
                `;
            });

            // New Members
            let newMemberCountRow = ""
            quarterlyReports.forEach((report, index) => {
                newMemberCountRow += `
                    <td>${report.newMemberCount}</td>
                `;
            });

            // Member Total
            let memberCountRow = ""
            quarterlyReports.forEach((report, index) => {
                memberCountRow += `
                    <td>${report.memberCount}</td>
                `;
            });

            // Connection Average
            let connectionAverageRow = ""
            quarterlyReports.forEach((report, index) => {
                if(report.overallConnectionCount === 0){
                    connectionAverageRow += `
                        <td>N/A</td>
                    `;
                }else{
                    connectionAverageRow += `
                    <td>${report.overallConnectionAverage.toFixed(3)}</td>
                `;
                }
            });

            // Connection Standard Deviation
            let connectionSDRow = ""
            quarterlyReports.forEach((report, index) => {
                if(report.overallConnectionSD === "NaN"){
                    connectionSDRow += `
                        <td>N/A</td>
                    `;
                }else{
                    connectionSDRow += `
                        <td>${report.overallConnectionSD.toFixed(3)}</td>
                    `;
                }
            });

            // Connection Total
            let connectionTotalRow = ""
            quarterlyReports.forEach((report, index) => {
                connectionTotalRow += `
                    <td>${report.overallConnectionCount}</td>
                `;
            });

            // Score Standard Deviation
            let scoreSDRow = ""
            quarterlyReports.forEach((report, index) => {
                if(report.overallScoreSD === "NaN"){
                    scoreSDRow += `<td>N/A</td>`;
                }else{
                    scoreSDRow += `
                    <td>${report.overallScoreSD.toFixed(3)}</td>
                `;
                }

            });

            // Score Average
            let scoreAverageRow = ""
            quarterlyReports.forEach((report, index) => {
                scoreAverageRow += `
                    <td style="color: ${getColorGradient(report.overallScoreAverage !== 'NaN'? report.overallScoreAverage : 0, -100, 100)}">${report.overallScoreAverage !== 'NaN'? report.overallScoreAverage.toFixed(3) : "N/A"}</td>
                `;
            });

            // Score Total
            let scoreTotalRow = ""
            quarterlyReports.forEach((report, index) => {
                scoreTotalRow += `
                    <td>${report.overallScoreTotal}</td>
                `;
            });

            // Human Metrics

            // Referring to Standard Deviation
            let mostVolatileRow = "";
            let leastVolatileRow = "";

            // Referring to evaluation slope
            let mostStableRow = "";
            let topGrossingRow = "";
            let bottomGrossingRow = "";

            // Streak checks
            let mostVolatileStreak = null;
            let leastVolatileStreak = null;
            let topGrossingStreak = null;
            let bottomGrossingStreak = null;
            let mostStableStreak = null;

            for(let report of quarterlyReports){
                let mostVolatile = null;
                let leastVolatile = null;

                // Referring to evaluation slope
                let mostStable = null; // closest to 0
                let topGrossing = null; // most positive
                let bottomGrossing = null; // most negative

                for(let m of report.memberReports){
                    if(m.scoreSD !== "NaN"){
                        if(mostVolatile == null || m.scoreSD > mostVolatile.scoreSD){
                            mostVolatile = m
                        }

                        if(leastVolatile == null || m.scoreSD < leastVolatile.scoreSD){
                            leastVolatile = m
                        }
                    }

                    if(m.scoreSlope !== "NaN"){
                        if(topGrossing == null || m.scoreSlope > topGrossing.scoreSlope){
                            topGrossing = m
                        }

                        if(bottomGrossing == null || m.scoreSlope < bottomGrossing.scoreSlope){
                            bottomGrossing = m
                        }

                        if(mostStable == null || Math.abs(m.scoreSlope) < Math.abs(mostStable.scoreSlope)){
                            mostStable = m
                        }
                    }
                }

                mostVolatileRow += renderMemberCell(mostVolatile, mostVolatile !== null && mostVolatile.id === mostVolatileStreak);
                if(mostVolatile !== null){
                    mostVolatileStreak = mostVolatile.id;
                }

                leastVolatileRow += renderMemberCell(leastVolatile, leastVolatile !== null && leastVolatile.id === leastVolatileStreak);
                if(leastVolatile !== null){
                    leastVolatileStreak = leastVolatile.id;
                }

                topGrossingRow += renderMemberCell(topGrossing, topGrossing !== null && topGrossing.id === topGrossingStreak);
                if(topGrossing !== null){
                    topGrossingStreak = topGrossing.id;
                }

                bottomGrossingRow += renderMemberCell(bottomGrossing, bottomGrossing !== null && bottomGrossing.id === bottomGrossingStreak);
                if(topGrossing !== null){
                    bottomGrossingStreak = bottomGrossing.id;
                }

                mostStableRow += renderMemberCell(mostStable, mostStable !== null && mostStable.id === mostStableStreak);
                if(mostStable !== null){
                    mostStableStreak = mostStable.id;
                }
            }

            document.querySelector("#overview-stats-table").innerHTML = `
                <table class="table table-hover align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>
                            <div>
                                <p class="m-0 p-0">Start Date</p>
                                <p class="m-0 p-0">End Date</p>
                            </div>
                        </th>
                        ${header}
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th class="text-nowrap">Activity Score</th>
                        ${newActivityScoreRow}
                    </tr>
                    <tr>
                        <th class="text-nowrap">Activity Total</th>
                        ${activityScoreRow}
                    </tr>
                    <tr>
                        <th class="text-nowrap">Added Members</th>
                        ${newMemberCountRow}
                    </tr>
                    <tr>
                        <th class="text-nowrap">Member Total</th>
                        ${memberCountRow}
                    </tr>
                    <tr>
                        <th class="text-nowrap">Connection Average</th>
                        ${connectionAverageRow}
                    </tr>
                    <tr>
                        <th class="text-nowrap">Connection Volatility</th>
                        ${connectionSDRow}
                    </tr>
                    <tr>
                        <th class="text-nowrap">Added Connections</th>
                        ${connectionTotalRow}
                    </tr>
                    <tr>
                        <th class="text-nowrap">Evaluation Average</th>
                        ${scoreAverageRow}
                    </tr>
                    <tr>
                        <th class="text-nowrap">Evaluation SD</th>
                        ${scoreSDRow}
                    </tr>
                    <tr>
                        <th class="text-nowrap">Evaluation Total</th>
                        ${scoreTotalRow}
                    </tr>

                    <tr>
                        <th class="text-nowrap">Most Volatile</th>
                        ${mostVolatileRow}
                    </tr>
                    <tr>
                        <th class="text-nowrap">Least Volatile</th>
                        ${leastVolatileRow}
                    </tr>
                    <tr>
                        <th class="text-nowrap">Top Grossing</th>
                        ${topGrossingRow}
                    </tr>
                    <tr>
                        <th class="text-nowrap">Bottom Grossing</th>
                        ${bottomGrossingRow}
                    </tr>
                    <tr>
                        <th class="text-nowrap">Most Stagnant</th>
                        ${mostStableRow}
                    </tr>
                </tbody>
            </table>`;
        }
    }

    function renderMemberCell(member, isStreak = false){
        if(member === null || member === undefined){
            return `<td class="text-center">N/A</td>`;
        }
        return `
            <td>
                <div class="d-flex flex-row gap-2 justify-content-start align-items-center">
                    <img class="square-image" style="height: 60px; width: 60px" alt="profile image" src="/api/interpersonal/member/profile-image/${member.id}">
                    <div>
                        <p class="p-0 m-0 fw-bold">${member.firstName} ${member.lastName} ${isStreak? "🔥": ""}</p>
                        <div class="">
                            <div class="d-flex flex-row gap-3 justify-content-start align-items-center">
                                <div class="d-flex flex-row gap-2 justify-content-start align-items-center">
                                    <img class="square-image" style="height: 15px; width: 15px" alt="profile image" src="/icons/Volatility.svg">
                                    <p class="p-0 m-0 text-nowrap">${member.scoreSD !== 'NaN'? member.scoreSD.toFixed(3) : "N/A"}</p>
                                </div>
                                <div class="d-flex flex-row gap-2 justify-content-start align-items-center">
                                    <img class="square-image" style="height: 15px; width: 15px" alt="profile image" src="/icons/SlopeScore.svg">
                                    <p class="p-0 m-0 text-nowrap" style="color: ${getColorGradient(member.scoreSlope !== 'NaN'? member.scoreSlope : 0, -0.6, 0.6)}">${member.scoreSlope !== 'NaN'? member.scoreSlope.toFixed(3) : "N/A"}</p>
                                </div>
                            </div>

                            <div class="d-flex flex-row gap-3 justify-content-start align-items-center">
                                <div class="d-flex flex-row gap-2 justify-content-start align-items-center">
                                    <img class="square-image" style="height: 15px; width: 15px" alt="profile image" src="/icons/ScoreCount.svg">
                                    <p class="p-0 m-0">${member.scoreCount}</p>
                                </div>
                                <div class="d-flex flex-row gap-2 justify-content-start align-items-center">
                                    <img class="square-image" style="height: 15px; width: 15px" alt="profile image" src="/icons/StartEnd.svg">
                                    <p class="p-0 m-0 text-nowrap">${member.startScore.cscore} → ${member.endScore.cscore}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </td>`;
    }
</script>
</body>
</html>