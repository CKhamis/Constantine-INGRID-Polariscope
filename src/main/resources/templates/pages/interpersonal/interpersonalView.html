<!DOCTYPE html>
<html xml:th="https://www.thymeleaf.org">
<head th:replace="~{components/Header :: head('View Member')}"></head>
<body class="bg-2 text-1" data-bs-theme="dark">
<div th:replace="~{components/Navigation :: vertical}"></div>
<main class="pt-3" style="margin-left: 60px">
<div class="container-fluid px-4">
    <nav class="navbar d-flex justify-content-between align-items-center">
        <div>
            <h2 class="fw-bold">Member Records</h2>
        </div>
        <div>
            <div class="spinner-border d-none" role="status" id="loading-spinner">
                <span class="visually-hidden">Loading...</span>
            </div>
            <img src="/icons/Error.svg" id="error-icon" alt="error" class="square-image d-none" height="32px" />
        </div>
        <div>
            <div class="input-group">
                <select class="form-select" id="member-select"></select>
                <button class="btn btn-primary bevel-sm" type="button" onclick="changeUser()">Change</button>
            </div>
        </div>
    </nav>

    <div class="row mt-3">
        <div class="col-md-3 col-lg-2 mb-4" id="left-pane">
            <img class="square-image" th:src="@{/icons/Logo.svg}" alt="profile image" id="profile-image" />
            <h2 class="fw-bold text-center mt-3" id="member-name">Test Name</h2>
            <div class="d-flex justify-content-between align-items-center mt-5">
                <img class="square-image mx-2" th:src="@{/icons/Logo.svg}" id="relation-icon" data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-title="Relationship"/>
                <img class="square-image mx-2" th:src="@{/icons/Logo.svg}" id="sex-icon" data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-title="Sex"/>
                <img class="square-image mx-2" th:src="@{/icons/Logo.svg}" id="orientation-icon" data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-title="Sexuality"/>
            </div>
            <div class="mt-4 bg-light-subtle d-flex justify-content-center align-items-center py-4 bevel-lg" role="button" data-bs-toggle="modal" data-bs-target="#addEvalModal" onclick="updateModal()">
                <p class="fs-4 fs-bold text-center m-0">+ Add Evaluation</p>
            </div>
        </div>
        <div class="col-md-9 col-lg-10 px-3" id="right-pane">
            <nav>
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                    <button class="nav-link active" id="nav-overview-tab" data-bs-toggle="tab" data-bs-target="#nav-overview" type="button" role="tab" aria-controls="nav-overview" aria-selected="true">Overview</button>
                    <button class="nav-link" id="nav-info-tab" data-bs-toggle="tab" data-bs-target="#nav-info" type="button" role="tab" aria-controls="nav-info" aria-selected="false">Information</button>
                    <button class="nav-link" id="nav-events-tab" data-bs-toggle="tab" data-bs-target="#nav-events" type="button" role="tab" aria-controls="nav-events" aria-selected="false">Events</button>
                    <button class="nav-link" id="nav-evaluation-tab" data-bs-toggle="tab" data-bs-target="#nav-evaluation" type="button" role="tab" aria-controls="nav-evaluation" aria-selected="false">Evaluations</button>
                    <button class="nav-link" id="nav-network-tab" data-bs-toggle="tab" data-bs-target="#nav-network" type="button" role="tab" aria-controls="nav-network" aria-selected="false">Relationships</button>
                    <button class="nav-link" id="nav-settings-tab" data-bs-toggle="tab" data-bs-target="#nav-settings" type="button" role="tab" aria-controls="nav-settings" aria-selected="false">Settings</button>
                </div>
            </nav>
            <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="nav-overview" role="tabpanel" aria-labelledby="nav-overview-tab" tabindex="0">
                    <h3 class="fw-bold mt-3">General Ovreview</h3>
                    <div class="row mt-2" id="member-chips"></div>
                    <canvas id="evaluation-history-chart-home"></canvas>
                    <div id="event-info-1" class="alert alert-secondary mt-2">Hover over event to see additional info</div>
                    <h3 class="fw-bold mt-3">Note History</h3>
                    <div id="note-list-home"></div>
                </div>
                <div class="tab-pane fade" id="nav-info" role="tabpanel" aria-labelledby="nav-info-tab" tabindex="0">
                    <h3 class="fw-bold mt-3">Member Information</h3>
                    <div class="row mt-2">
                        <div class="col-12 mb-3">
                            <label for="pfp-file" class="form-label">Upload profile image for member</label>
                            <input class="form-control" type="file" name="file" accept="image/*" id="pfp-file">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="fnf">First name</label>
                            <input type="text" class="form-control" id="fnf" name="firstName" placeholder="First name" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="lnf">Last name</label>
                            <input type="text" class="form-control" id="lnf" name="lastName" placeholder="Last name">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="mnf">Middle name</label>
                            <input type="text" class="form-control" id="mnf" name="middleName" placeholder="Middle name">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="relationf">Relationship Type</label>
                            <select class="form-select" id="relationf" name="relationship" required>
                                <option value="" disabled="disabled">Select Relationship Type</option>
                                <th:block th:each="relationshipType : ${relationshipTypes}">
                                    <option th:value="${relationshipType}" th:text="${relationshipType.toString().toLowerCase()}"></option>
                                </th:block>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="sexf">Sex</label>
                            <select class="form-select" id="sexf" name="relationship">
                                <option value="">Decline to state</option>
                                <th:block th:each="SexType : ${sexTypes}">
                                    <option th:value="${SexType}" th:text="${SexType.toString().toLowerCase()}"></option>
                                </th:block>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="sexualityf">Sexuality</label>
                            <select class="form-select" id="sexualityf" name="sexuality">
                                <option value="">Decline to state</option>
                                <th:block th:each="sexualityType : ${sexualityTypes}">
                                    <option th:value="${sexualityType}" th:text="${sexualityType.toString().toLowerCase()}"></option>
                                </th:block>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="mbp">MB Personality</label>
                            <input type="text" class="form-control" id="mbp" name="personality" placeholder="ENFJ">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="fcf">Favorite Color</label>
                            <input type="text" class="form-control" id="fcf" name="favoriteColor" placeholder="Red">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="amf">Year Met</label>
                            <input type="number" class="form-control" id="amf" name="ageMet" placeholder="2001" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="bdf">Birthday</label>
                            <input type="date" class="form-control" id="bdf" name="birthday">
                        </div>

                        <div class="col-md-4 mb-3">
                            <label for="group-form">Primary Group</label>
                            <select class="form-select" id="group-form">
                                <option value="" selected>None</option>
                            </select>
                        </div>

                        <div class="col-12 mb-3">
                            <label for="df">Description</label>
                            <input type="text" class="form-control" id="df" name="description" placeholder="Description of member">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary" onclick="saveMember()" id="submit-button">Submit</button>
                </div>
                <div class="tab-pane fade" id="nav-evaluation" role="tabpanel" aria-labelledby="nav-evaluation-tab" tabindex="0">
                    <h3 class="fw-bold mt-3">Evaluation Records</h3>
                    <div>
                        <canvas id="evaluation-history-chart"></canvas>
                    </div>
                    <div>
                        <div id="event-info-2" class="alert alert-secondary mt-2">Hover over event to see additional info</div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <h2 class="fw-bold mt-3">All Evaluations</h2>

                        <div class="bg-light-subtle d-flex justify-content-between align-items-center p-2" role="button" data-bs-toggle="modal" data-bs-target="#filterModal">
                            <p class="mb-0 mx-2 fs-5 fw-bold">Filter</p>
                            <img class="square-image" th:src="@{/icons/Filter.svg}" alt="edit" style="width: 30px;"/>
                        </div>
                    </div>
                    <div id="eval-table-container"></div>
                </div>
                <div class="tab-pane fade" id="nav-events" role="tabpanel" aria-labelledby="nav-events-tab" tabindex="0">
                    <div class="d-flex flex-row justify-content-between align-items-center">
                        <h3 class="fw-bold mt-3">All Events</h3>
                        <button class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#event-modal">Add/ Remove Events</button>
                    </div>
                    <div id="events-container"></div>
                </div>
                <div class="tab-pane fade" id="nav-network" role="tabpanel" aria-labelledby="nav-network-tab" tabindex="0">
                    <div class="h-100" id="graph-container"></div>
                    <div class="position-absolute bottom-0 end-0 bg-body-tertiary p-3 m-3 d-flex flex-row gap-2">
                        <button type="button" class="btn bg-light-subtle d-flex justify-content-center align-items-center p-2" data-bs-toggle="tooltip" data-bs-title="Reset View" onclick="cy.reset()">
                            <img class="square-image" src="/icons/Reset%20Zoom.svg" alt="refresh" style="width: 30px;">
                        </button>
                        <button type="button" class="btn bg-light-subtle d-flex justify-content-center align-items-center p-2" data-bs-toggle="modal" data-bs-target="#graph-modal">
                            <img class="square-image" src="/icons/Settings.svg" alt="refresh" style="width: 30px;">
                        </button>
                    </div>
                </div>
                <div class="tab-pane fade" id="nav-settings" role="tabpanel" aria-labelledby="nav-settings-tab" tabindex="0">
                    <h3 class="fw-bold mt-3">Member Settings</h3>
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title fw-bold">Add or Remove Events</h5>
                            <p class="card-text">This will add or remove markers on the member's evaluation graphs. Use this to highlight important events.</p>
                            <button class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#event-modal">Add/ Remove Events</button>
                        </div>
                    </div>
                    <div class="card mt-3">
                        <div class="card-body">
                            <h5 class="card-title fw-bold">Score Hold</h5>
                            <p class="card-text">This will remove the member's appearance in the Batch Evaluate feature. Use this option if you do not anticipate not updating evaluations as frequently.</p>
                            <input type="checkbox" class="btn-check" id="score-hold-check" autocomplete="off">
                            <label class="btn btn-primary" for="score-hold-check" onclick="scoreHold()" id="hold-label">Score Hold</label>
                        </div>
                    </div>
                    <div class="card mt-3">
                        <div class="card-body">
                            <h5 class="card-title fw-bold">Archive Member</h5>
                            <p class="card-text">Removes appearances of member from all menus except for the all members feature. Does not delete the member.</p>
                            <input type="checkbox" class="btn-check" id="archive-member-check" autocomplete="off">
                            <label class="btn btn-primary" for="archive-member-check" onclick="archive()" id="archive-label">Archive Member</label>
                        </div>
                    </div>
                    <div class="card mt-3">
                        <div class="card-body">
                            <h5 class="card-title fw-bold">Delete Member</h5>
                            <p class="card-text">Deletes a member from database permanently. This procedure deletes the member as well as associated data such as evaluations. Not recommended for almost any scenario</p>
                            <button class="btn btn-danger bevel-sm" data-bs-toggle="modal" data-bs-target="#deleteMemberModal">Delete Member</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</main>

<div class="modal fade" id="addEvalModal" tabindex="-1" aria-labelledby="aemt" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="aemt">Save Evaluation</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-12">
                        <h4 class="fw-bold text-center" id="recent-score-modal"></h4>
                    </div>
                    <div class="col-9">
                        <label for="date-form-modal" class="form-label">Date</label>
                        <input type="datetime-local" class="form-control" id="date-form-modal">
                    </div>
                    <div class="col-3 mb-3">
                        <label for="cScore-form-modal" class="form-label">cScore</label>
                        <input type="number" class="form-control" id="cScore-form-modal" required>
                    </div>
                    <div class="col-12">
                        <label for="note-form-modal" class="form-label">Note</label>
                        <textarea class="form-control" id="note-form-modal" rows="3"></textarea>
                    </div>
                    <input type="hidden" id="id-evaluation-modal" />
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="modalSaveEval()" data-bs-dismiss="modal">Save changes</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="deleteMemberModal" tabindex="-1" aria-labelledby="dmm" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="dmm">Delete Member & Evaluations?</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>This action cannot be undone unless a backup was made and restored. This will delete all evaluations and member details permanently. It is highly recommended to archive and hold rather than delete members. If you have read this warning and would still like to delete the member, use the button below.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-danger" onclick="deleteMember()" data-bs-dismiss="modal">Save changes</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="filterModal" tabindex="-1" aria-labelledby="fmt" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="fmt">Filter Settings</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-12">
                        <label for="before-form" class="form-label">Show Evaluations Before</label>
                        <div class="input-group mb-3" id="before-form">
                            <div class="input-group-text">
                                <input class="form-check-input mt-0" type="checkbox" value="" id="before-checkbox-filter-modal" aria-label="Enable filtering before a date">
                            </div>
                            <input type="datetime-local" class="form-control" aria-label="before input" id="before-form-filter-modal">
                        </div>
                    </div>
                    <div class="col-12">
                        <label for="after-form" class="form-label">Show Evaluations After</label>
                        <div class="input-group mb-3" id="after-form">
                            <div class="input-group-text">
                                <input class="form-check-input mt-0" type="checkbox" value="" id="after-checkbox-filter-modal" aria-label="Enable filtering after a date">
                            </div>
                            <input type="datetime-local" class="form-control" aria-label="after input" id="after-form-filter-modal">
                        </div>
                    </div>
                    <div class="col-12">
                        <label for="keyword-filter-modal" class="form-label">Note contains</label>
                        <textarea class="form-control" id="keyword-filter-modal" rows="3"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="renderEvaluationTable()" data-bs-dismiss="modal">Save changes</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" tabindex="-1" aria-labelledby="be" id="event-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="be">Events</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-12">
                        <p>Please choose events you would like to be depicted inside evaluation graphs. To add more events, please go to settings</p>
                    </div>
                    <div class="col-12">
                        <div class="accordion">
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="false" aria-controls="panelsStayOpen-collapseOne">
                                        Included Events
                                    </button>
                                </h2>
                                <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse">
                                    <div class="list-group" id="event-list-included">
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="false" aria-controls="panelsStayOpen-collapseTwo">
                                        Events Not Included
                                    </button>
                                </h2>
                                <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse">
                                    <div class="list-group" id="event-list-not-included">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="saveEventModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="saveEventModalTitle">Save Event</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-12 mb-3">
                        <label for="event-label-form" class="form-label">Label</label>
                        <input type="text" class="form-control" id="event-label-form" required>
                    </div>
                    <div class="col-12 mb-3">
                        <label for="event-date-form" class="form-label">Date</label>
                        <input type="datetime-local" class="form-control" id="event-date-form">
                    </div>
                    <div class="col-12">
                        <label for="event-description-form" class="form-label">Description</label>
                        <textarea class="form-control" id="event-description-form" rows="3"></textarea>
                    </div>
                    <div class="col-12 mt-3">
                        <label for="event-color-preview" class="form-label">Color</label>
                        <div class="container" style="height:40px" id="event-color-preview"></div>
                    </div>
                    <div class="col-4">
                        <div class="input-group">
                            <label class="input-group-text" for="event-red-form">Red</label>
                            <input type="number" class="form-control" id="event-red-form">
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="input-group">
                            <label class="input-group-text" for="event-green-form">Green</label>
                            <input type="number" class="form-control" id="event-green-form">
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="input-group">
                            <label class="input-group-text" for="event-blue-form">Blue</label>
                            <input type="number" class="form-control" id="event-blue-form">
                        </div>
                    </div>
                    <input type="hidden" id="event-id-form" />
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="modalSaveEvent()" data-bs-dismiss="modal">Save Event</button>
            </div>
        </div>
    </div>
</div>

<input type="hidden" th:value="${id}" id="id-form" />
<div th:replace="~{components/External :: external}"></div>
<div th:replace="~{components/Network :: data-upload}"></div>
<div th:replace="~{components/Network :: network}"></div>
<div th:replace="~{components/External :: tooltips}"></div>
<div th:replace="~{components/Formatting :: timestamp-formatting}"></div>
<div th:replace="~{components/Formatting :: date-formatting}"></div>
<div th:replace="~{components/Formatting :: time-interval}"></div>
<div th:replace="~{components/Gradient :: gradient}"></div>
<div th:replace="~{components/Toast :: toast}"></div>
<script>
    let memberList;
    let memberDetails;
    let eventList;
    let enums;
    let evalChartEval, evalChartEvalHome;

    refresh();
    createEvalChart();

    function refresh(){
        let memberId = document.querySelector("#id-form").value;
        let spinner = document.querySelector("#loading-spinner");
        spinner.classList.add("d-block");
        spinner.classList.remove("d-none");
        let errorIcon = document.querySelector("#error-icon");

        const memberListFetch = fetch("/api/interpersonal/member/all", {});
        const enumFetch = fetch("/api/interpersonal/enums", {});
        const memberDetailFetch = fetch("/api/interpersonal/member/view/" + memberId, {});
        const allEventFetch = fetch("/api/interpersonal/event/all", {});
        Promise.all([memberListFetch, memberDetailFetch, enumFetch, allEventFetch])
            .then(responses => {
                return Promise.all(responses);
            })
            .then(data => {
                return Promise.all([data[0].json(), data[1].json(), data[2].json(), data[3].json()]);
            })
            .then(data => {
                tableAddons = "";
                memberList = data[0];
                memberDetails = data[1];
                enums = data[2];
                eventList = data[3];
                renderMemberSelect(data[0]);
                renderBadges();
                document.querySelector("#member-name").textContent = memberDetails.firstName + " " + memberDetails.lastName;
                if(memberDetails.mostRecentEval != null){
                    document.querySelector("#recent-score-modal").textContent = "Most recent cScore: " + memberDetails.mostRecentEval.cscore;
                }
                renderOverviewTab();
                renderInfoTab();
                updateEvalChart();
                renderEvaluationTable();
                updateEventModal();
                updateGroups();
                updateEventsTab();
            })
            .then((response) => {
                if(memberDetails.group !== null){
                    document.querySelector("#group-form").value = memberDetails.group.id;
                }
                return response;
            })
            .catch((response) => {
                console.log(response);
                errorIcon.classList.add("d-block");
                errorIcon.classList.remove("d-none");

                response.json()
                    .then(errorData => {
                        console.log(errorData.message);
                    })
                    .catch(error => {
                        console.error("Error parsing error response:", error);
                    });
            })
            .finally(() => {
                document.querySelector("#profile-image").src = "/api/interpersonal/member/profile-image/" + memberDetails.id + "?=" + new Date().getTime();
                spinner.classList.remove("d-block");
                spinner.classList.add("d-none");
            });
    }

    function updateEventsTab(){
        let content = "";

        memberDetails.events.forEach((event) => {
            content += `
            <div class="alert alert-secondary mt-2" style="background: linear-gradient(to top right, rgb(${event.color.red}, ${event.color.green}, ${event.color.blue},.03), rgb(${event.color.red}, ${event.color.green}, ${event.color.blue},.15))">
                <div class="d-flex flex-row justify-content-between align-items-center">
                    <p class="fs-4 fw-bold text-white">${event.label}</p>
                    <p class="fw-bold text-white">${formatTimestamp(event.date)}</p>
                    <button class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#saveEventModal" style="background-color: rgba(200,200,200,.3)" onclick="updateEventSaveModal('${event.id}')">Edit Event</button>
                </div>
                <p class="fs-5 text-white">${event.description.length > 0? event.description : "No description given"}</p>
            </div>
            `;
        });

        if(memberDetails.events.length === 0){
            content = "<p class='text-center mt-3'>No events added.</p>";
        }

        document.querySelector("#events-container").innerHTML = content;
    }

    function updateEventModal(){
        const notIncludedContainer = document.querySelector("#event-list-not-included");
        const includedContainer = document.querySelector("#event-list-included");
        let notIncluded = "", included = "";

        eventList.forEach((event) => {
            let element = `<button type="button" class="list-group-item list-group-item-action d-flex align-items-center justify-content-between gap-2" onclick="toggleEvent('${event.id}')">
                            <p class="mb-0 fw-bold ms-2">${event.label}</p>
                            <div class="d-flex justify-content-start gap-2 align-items-center">
                                <p class="mb-0">${formatTimestamp(event.date)}</p>
                                <div style="height: 30px; width:30px; background-color: rgb(${event.color.red}, ${event.color.green}, ${event.color.blue})"></div>
                            </div>
                        </button>`;

            console.log(event);

            if(memberDetails.events.some(mem => mem.id === event.id)){
                included += element;
            }else{
                notIncluded += element;
            }
        });
        notIncludedContainer.innerHTML = notIncluded;
        includedContainer.innerHTML = included;
    }

    function toggleEvent(id){
        const data = {
            memberId: memberDetails.id,
            eventId: id
        }
        let errorIcon = document.querySelector("#error-icon");
        let toastId = createToast("Toggling Event");
        postData("/api/interpersonal/event/change-member", data)
            .then((message) => {
                console.log(message);
                document.getElementById(`${toastId}-title`).innerText = message.title;
                document.getElementById(`${toastId}-body`).innerText = getIcon(message.severity) + message.message;
                document.getElementById(`${toastId}-loading`).style.color = "green";
            })
            .catch((response) => {
                errorIcon.classList.add("d-block");
                errorIcon.classList.remove("d-none");
                response.json()
                    .then(errorData => {
                        document.getElementById(`${toastId}-body`).innerText = getIcon(errorData.severity) + errorData.message;
                        document.getElementById(`${toastId}-title`).innerText = errorData.title;
                        document.getElementById(`${toastId}-loading`).style.color = "red";
                    })
                    .catch(error => {
                        console.error("Error parsing error response:", error);
                        document.getElementById(`${toastId}-body`).innerText = "Unable to delete member";
                        document.getElementById(`${toastId}-title`).innerText = "Error";
                        document.getElementById(`${toastId}-loading`).style.color = "red";
                    });
            })
            .finally(() => {
                refresh();
            });
    }


    function updateGroups(){
        let content = `<option value="">None</option>`;

        enums.groups.forEach((group) => {
            content += `<option value="${group.id}">${group.name}</option>`;
        });

        document.querySelector("#group-form").innerHTML = content;
    }

    function modalSaveEval(){
        const idField = document.querySelector("#id-evaluation-modal").value;
        let id = null;

        let spinner = document.querySelector("#loading-spinner");
        spinner.classList.add("d-block");
        spinner.classList.remove("d-none");
        let errorIcon = document.querySelector("#error-icon");

        if(idField.length > 0){
            id = idField;
        }
        let data = {
            "id": id,
            "timestamp": document.querySelector("#date-form-modal").value,
            "cscore": document.querySelector("#cScore-form-modal").value,
            "note": document.querySelector("#note-form-modal").value,
            "memberId": document.querySelector("#id-form").value
        };

        let toastId = createToast("Saving Evaluation");
        postData("/api/interpersonal/evaluation/save", data)
            .then((message) => {
                console.log(message);
                document.getElementById(`${toastId}-title`).innerText = message.title;
                document.getElementById(`${toastId}-body`).innerText = getIcon(message.severity) + message.message;
                document.getElementById(`${toastId}-loading`).style.color = "green";
            })
            .catch((response) => {
                errorIcon.classList.add("d-block");
                errorIcon.classList.remove("d-none");
                response.json()
                    .then(errorData => {
                        document.getElementById(`${toastId}-body`).innerText = getIcon(errorData.severity) + errorData.message;
                        document.getElementById(`${toastId}-title`).innerText = errorData.title;
                        document.getElementById(`${toastId}-loading`).style.color = "red";
                    })
                    .catch(error => {
                        console.error("Error parsing error response:", error);
                        document.getElementById(`${toastId}-body`).innerText = "Unable to save evaluation";
                        document.getElementById(`${toastId}-title`).innerText = "Error";
                        document.getElementById(`${toastId}-loading`).style.color = "red";
                    });
            })
            .finally(() => {
                refresh();
                spinner.classList.remove("d-block");
                spinner.classList.add("d-none");

                document.querySelector("#id-evaluation-modal").value = "";
            });
    }

    function deleteMember(){
        let id = memberDetails.id;

        let spinner = document.querySelector("#loading-spinner");
        spinner.classList.add("d-block");
        spinner.classList.remove("d-none");
        let errorIcon = document.querySelector("#error-icon");

        let toastId = createToast("Deleting Member");
        postData("/api/interpersonal/member/delete", id)
            .then((message) => {
                console.log(message);
                document.getElementById(`${toastId}-title`).innerText = message.title;
                document.getElementById(`${toastId}-body`).innerText = getIcon(message.severity) + message.message;
                document.getElementById(`${toastId}-loading`).style.color = "green";
            })
            .catch((response) => {
                errorIcon.classList.add("d-block");
                errorIcon.classList.remove("d-none");
                response.json()
                    .then(errorData => {
                        document.getElementById(`${toastId}-body`).innerText = getIcon(errorData.severity) + errorData.message;
                        document.getElementById(`${toastId}-title`).innerText = errorData.title;
                        document.getElementById(`${toastId}-loading`).style.color = "red";
                    })
                    .catch(error => {
                        console.error("Error parsing error response:", error);
                        document.getElementById(`${toastId}-body`).innerText = "Unable to delete member";
                        document.getElementById(`${toastId}-title`).innerText = "Error";
                        document.getElementById(`${toastId}-loading`).style.color = "red";
                    });
            })
            .finally(() => {
                refresh();
                spinner.classList.remove("d-block");
                spinner.classList.add("d-none");

                document.querySelector("#id-evaluation-modal").value = "";

                window.location.href = "/interpersonal/new";
            });
    }

    function deleteEvaluation(id){
        let toastId = createToast("Delete Evaluation");
        postData("/api/interpersonal/evaluation/delete", id)
            .then((message) => {
                document.getElementById(`${toastId}-title`).innerText = message.title;
                document.getElementById(`${toastId}-body`).innerText = getIcon(message.severity) + message.message;
                document.getElementById(`${toastId}-loading`).style.color = "green";
            })
            .catch((response) => {
                console.log(response);
                response.json()
                    .then(errorData => {
                        document.getElementById(`${toastId}-body`).innerText = getIcon(errorData.severity) + errorData.message;
                        document.getElementById(`${toastId}-title`).innerText = errorData.title;
                        document.getElementById(`${toastId}-loading`).style.color = "red";
                    })
                    .catch(error => {
                        console.error("Error parsing error response:", error);
                        document.getElementById(`${toastId}-body`).innerText = "Unable to connect to Polariscope Online Services";
                        document.getElementById(`${toastId}-title`).innerText = "Error";
                        document.getElementById(`${toastId}-loading`).style.color = "red";
                    });
            })
            .then(refresh);
    }

    function renderOverviewTab(){
        if(memberDetails.fullTimeline == null || memberDetails.mostRecentEval == null){
            document.querySelector("#member-chips").innerHTML = `
            <div class="alert alert-primary mx-3" role="alert">
              <h4 class="text-center fw-bold mb-0">Add evaluations to see stats</h4>
            </div>
            `;
            return;
        }
        let noteContent = "";

        memberDetails.fullTimeline.forEach((evaluation) => {
            if(evaluation.note.length > 0){
                noteContent += `
                <div class="d-flex justify-content-start alert alert-secondary mb-2">
                    <p class="mb-0 fw-bold">${formatDate(evaluation.timestamp)}</p>
                    <p class="mb-0 mx-3" style="color: ${getColorGradient(evaluation.cscore, -100, 100)}">${evaluation.cscore}</p>
                    <p class="mb-0">${evaluation.note}</p>
                </div>
                `;
            }
        });

        document.querySelector("#note-list-home").innerHTML = noteContent;

        let rhBackground;
        if(memberDetails.mostRecentEval.cscore > 100 || memberDetails.mostRecentEval.cscore < -100){
            rhBackground = "light";
        }else if(memberDetails.mostRecentEval.cscore >= 99){
            rhBackground = "primary";
        }else if(memberDetails.mostRecentEval.cscore >= 80){
            rhBackground = "info";
        }else if(memberDetails.mostRecentEval.cscore >= 30){
            rhBackground = "success";
        }else if(memberDetails.mostRecentEval.cscore >= -30){
            rhBackground = "warning";
        }else{
            rhBackground = "danger";
        }


        let memberChipHTML = `
            <div class="col-12 col-lg-3">
                <div class="mx-2 alert alert-${rhBackground}">
                    <h6 class="text-center fw-bold">Current Evaluation</h6>
                    <p class="text-center fs-2 mb-0">${memberDetails.mostRecentEval.cscore}</p>
                </div>
            </div>
            <div class="col-12 col-lg-3">
                <div class="mx-2 alert alert-secondary">
                    <h6 class="text-center fw-bold">Edit Counter</h6>
                    <p class="text-center fs-2 mb-0">${memberDetails.editCount}</p>
                </div>
            </div>
            <div class="col-12 col-lg-3">
                <div class="mx-2 alert alert-secondary">
                    <h6 class="text-center fw-bold">cScore Entries</h6>
                    <p class="text-center fs-2 mb-0">${memberDetails.fullTimeline.length}</p>
                </div>
            </div>
            <div class="col-12 col-lg-3">
                <div class="mx-2 alert alert-secondary">
                    <h6 class="text-center fw-bold">Record Age</h6>
                    <p class="text-center fs-2 mb-0">${timeSince(memberDetails.created)}</p>
                </div>
            </div>
            `;

        document.querySelector("#member-chips").innerHTML = memberChipHTML;
    }

    function renderInfoTab(){
        document.querySelector("#fnf").value = memberDetails.firstName;
        document.querySelector("#lnf").value = memberDetails.lastName;
        document.querySelector("#mnf").value = memberDetails.middleName;
        document.querySelector("#relationf").value = memberDetails.relationship;
        document.querySelector("#sexf").value = memberDetails.sex;
        document.querySelector("#sexualityf").value = memberDetails.sexuality;
        document.querySelector("#mbp").value = memberDetails.personality;
        document.querySelector("#fcf").value = memberDetails.favoriteColor;
        document.querySelector("#amf").value = memberDetails.ageMet;
        document.querySelector("#bdf").value = new Date(memberDetails.birthday).toISOString().slice(0, 10);
        document.querySelector("#df").value = memberDetails.description;

        document.querySelector("#archive-member-check").checked = memberDetails.archive;
        document.querySelector("#archive-label").textContent = (memberDetails.archive? "Archived" : "Archive Member")
        document.querySelector("#score-hold-check").checked = memberDetails.scoreHold;
        document.querySelector("#hold-label").textContent = (memberDetails.scoreHold? "On Hold" : "Hold Member")
    }

    function scoreHold(){
        memberDetails.scoreHold = !memberDetails.scoreHold;
        saveMember();
    }

    function archive(){
        memberDetails.archive = !memberDetails.archive;
        saveMember();
    }
    function saveMember(){
        const formData = new FormData();
        const imageFile = document.getElementById('pfp-file').files[0];
        formData.append('image', imageFile);
        formData.append('id', memberDetails.id);
        formData.append('firstName', document.querySelector("#fnf").value);
        formData.append('lastName', document.querySelector("#lnf").value);
        formData.append('middleName', document.querySelector("#mnf").value);
        formData.append('relationship', document.querySelector("#relationf").value);
        formData.append('sex', document.querySelector("#sexf").value);
        formData.append('sexuality', document.querySelector("#sexualityf").value);
        formData.append('personality', document.querySelector("#mbp").value);
        formData.append('favoriteColor', document.querySelector("#fcf").value);
        formData.append('ageMet', document.querySelector("#amf").value);
        formData.append('birthday', document.querySelector("#bdf").value);
        formData.append('description', document.querySelector("#df").value);
        formData.append('group', document.querySelector("#group-form").value);

        formData.append('archive', memberDetails.archive);
        formData.append('scoreHold', memberDetails.scoreHold);

        let button = document.querySelector("#submit-button");
        button.disabled = true;
        button.classList.remove("btn-primary");
        button.classList.add("btn-disabled");
        button.textContent = "Saving...";

        let toastId = createToast("Saving Member Details");
        postDataWithFile("/api/interpersonal/member/save", formData)
            .then((message) => {
                message.json()
                    .then(messageData => {
                        document.getElementById(`${toastId}-body`).innerText = getIcon(messageData.severity) + messageData.message;
                        document.getElementById(`${toastId}-title`).innerText =  messageData.title;
                        document.getElementById(`${toastId}-loading`).style.color = "green";
                    })
                    .catch(error => {
                        console.error("Error parsing error response:", error);
                        document.getElementById(`${toastId}-body`).innerText = "Unable to connect to Polariscope Online Services";
                        document.getElementById(`${toastId}-title`).innerText = "Error";
                        document.getElementById(`${toastId}-loading`).style.color = "red";
                    });
            })
            .catch((response) => {
                console.log(response);
                response.json()
                    .then(errorData => {
                        document.getElementById(`${toastId}-body`).innerText = getIcon(errorData.severity) + errorData.message;
                        document.getElementById(`${toastId}-title`).innerText = errorData.title;
                        document.getElementById(`${toastId}-loading`).style.color = "red";
                    })
                    .catch(error => {
                        console.error("Error parsing error response:", error);
                        document.getElementById(`${toastId}-body`).innerText = "Unable to connect to Polariscope Online Services";
                        document.getElementById(`${toastId}-title`).innerText = "Error";
                        document.getElementById(`${toastId}-loading`).style.color = "red";
                    });
            })
            .then(refresh)
            .finally(() => {
                button.disabled = false;
                button.classList.remove("btn-disabled");
                button.classList.add("btn-primary");
                button.textContent = "Submit";
            });
    }

    function renderMemberSelect(members){
        let HTMLContent = ``;
        members.forEach((member) => {
            HTMLContent += `
                <option value="${member.id}">${member.firstName} ${member.lastName}</option>
            `;
        });
        document.querySelector("#member-select").innerHTML = HTMLContent;
    }

    function renderBadges(){
        let relationshipIcon = document.querySelector("#relation-icon");
        if(memberDetails.relationship.length > 0){
            relationshipIcon.src = "/icons/relations/" + memberDetails.relationship + ".svg";
        }else{
            relationshipIcon.src = "/icons/Unknown.svg";
        }

        let sexIcon = document.querySelector("#sex-icon");
        if(memberDetails.sex.length > 0){
            sexIcon.src = "/icons/sex/" + memberDetails.sex + ".svg";
        }else{
            sexIcon.src = "/icons/Unknown.svg";
        }

        let sexualityIcon = document.querySelector("#orientation-icon");
        if(memberDetails.sex.length > 0){
            sexualityIcon.src = "/icons/sexuality/" + memberDetails.sexuality + ".svg";
        }else{
            sexualityIcon.src = "/icons/Unknown.svg";
        }
    }

    function renderEvaluationTable(){
        let tableHTML = `
        <table class="table">
            <thead>
                <tr>
                    <th scope="col">Timestamp</th>
                    <th scope="col">cScore</th>
                    <th scope="col">Note</th>
                    <th scope="col">Edit</th>
                    <th scope="col">Duplicate</th>
                    <th scope="col">Delete</th>
                </tr>
            </thead>
            <tbody>
        `;

        const beforeFilterEnable = document.querySelector("#before-checkbox-filter-modal").checked;
        const beforeForm = new Date(document.querySelector("#before-form-filter-modal").value);
        const afterFilterEnable = document.querySelector("#after-checkbox-filter-modal").checked;
        const afterForm = new Date(document.querySelector("#after-form-filter-modal").value);
        const filterByKeywordEnable = document.querySelector("#keyword-filter-modal").value.length > 0;
        const noteHas = document.querySelector("#keyword-filter-modal").value;


        if(memberDetails.fullTimeline == null){return;}

        memberDetails.fullTimeline.forEach((eval) => {
            if((!beforeFilterEnable || beforeForm > new Date(eval.timestamp)) && (!afterFilterEnable || afterForm < new Date(eval.timestamp)) && (!filterByKeywordEnable || eval.note.includes(noteHas))){
                tableHTML += `
                <tr id="${eval.id}">
                    <th>${formatTimestamp(eval.timestamp)}</th>
                    <th>${eval.cscore}</th>
                    <th>${eval.note}</th>
                    <th><button class="btn btn-secondary" onclick="updateModal(false, '${eval.id}')" data-bs-toggle="modal" data-bs-target="#addEvalModal">Edit</button></th>
                    <th><button class="btn btn-secondary" onclick="updateModal(true, '${eval.id}')" data-bs-toggle="modal" data-bs-target="#addEvalModal">Duplicate</button></th>
                    <th><button class="btn btn-danger bevel-sm" onclick="deleteEvaluation('${eval.id}')">Delete</button></th>
                </tr>
            `;
            }
        });

        tableHTML +="</tbody></table>";
        document.querySelector("#eval-table-container").innerHTML = tableHTML;
    }

    function changeUser(){
        document.querySelector("#id-form").value = document.querySelector("#member-select").value;
        refresh();
    }

    function updateModal(isNew = true, id = ""){
        if(id === ""){
            document.querySelector("#aemt").textContent = "New Evaluation";
            document.querySelector("#cScore-form-modal").value = "";
            document.querySelector("#note-form-modal").value = "";
            document.querySelector("#id-evaluation-modal").value = "";
            document.getElementById('date-form-modal').value = new Date().toISOString().slice(0, 16);
        }else{
            const eval = memberDetails.fullTimeline.find(eval => eval.id === id);

            const parsedDate = new Date(eval.timestamp);
            const localDate = new Date(parsedDate.getTime() - parsedDate.getTimezoneOffset() * 60000);
            const formattedDate = localDate.toISOString().slice(0, 16); // Format as "YYYY-MM-DDTHH:MM"

            document.getElementById('date-form-modal').value = formattedDate;
            document.querySelector("#cScore-form-modal").value = eval.cscore;
            document.querySelector("#note-form-modal").value = eval.note;

            if(isNew){
                document.querySelector("#aemt").textContent = "Duplicate Evaluation";
                document.querySelector("#id-evaluation-modal").value = "";
            }else{
                document.querySelector("#aemt").textContent = "Edit Evaluation";
                document.querySelector("#id-evaluation-modal").value = id;
            }
        }
    }

    function updateEvalChart() {
        let newScores = { data: [] };

        if (memberDetails.fullTimeline == null) {
            return;
        }

        // Update chart data
        memberDetails.fullTimeline.forEach((eval) => {
            newScores.data.push({ x: new Date(eval.timestamp), y: eval.cscore });
        });

        // Update datasets
        evalChartEval.data.datasets.pop();
        evalChartEval.data.datasets.push(newScores);

        evalChartEvalHome.data.datasets.pop();
        evalChartEvalHome.data.datasets.push(newScores);

        // Clear existing annotations
        evalChartEval.options.plugins.annotation.annotations = [];
        evalChartEvalHome.options.plugins.annotation.annotations = [];

        // Add new annotations based on memberDetails.events
        if (memberDetails.events) {
            const newAnnotations = memberDetails.events.map((event, index) => ({
                type: 'line',
                xScaleID: 'x',
                xMin: event.date,
                xMax: event.date,
                borderColor: `rgba(${event.color.red}, ${event.color.green}, ${event.color.blue}, 1)`,
                borderWidth: 2,
                label: {
                    content: event.label,
                    display: true,
                    position: 'start',
                    backgroundColor: `rgba(${event.color.red}, ${event.color.green}, ${event.color.blue}, 0.8)`,
                    color: 'white',
                    yAdjust: -10
                },
                click: function(e) {
                    updateEventSaveModal(event.id);
                    let myModal = new bootstrap.Modal(document.getElementById('saveEventModal'));
                    myModal.show();
                },
                enter: function(e) {
                    let content = `
                    <div class="d-flex flex-row justify-content-between align-items-center">
                        <p class="fs-5 fw-bold text-center">${event.label}</p>
                        <p class="fw-bold text-center">${formatTimestamp(event.date)}</p>
                        <button class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#saveEventModal" style="background-color: rgba(200,200,200,.3)" onclick="updateEventSaveModal('${event.id}')">Edit Event</button>
                    </div>
                    ${event.description.length > 0? "<p class='fs-5'>" + event.description + "</p>" : "<p class='text-center fs-5'>No description given</p>"}</p>
                    `;

                    document.querySelector("#event-info-1").innerHTML = content;
                    document.querySelector("#event-info-2").innerHTML = content;

                    document.querySelector("#event-info-1").style.background = `linear-gradient(to top right, rgb(${event.color.red}, ${event.color.green}, ${event.color.blue},.03), rgb(${event.color.red}, ${event.color.green}, ${event.color.blue},.15))`;
                    document.querySelector("#event-info-2").style.background = `linear-gradient(to top right, rgb(${event.color.red}, ${event.color.green}, ${event.color.blue},.03), rgb(${event.color.red}, ${event.color.green}, ${event.color.blue},.15))`;
                },
            }));

            // Apply annotations to both charts
            evalChartEval.options.plugins.annotation.annotations = newAnnotations;
            evalChartEvalHome.options.plugins.annotation.annotations = newAnnotations;
        }

        // Update both charts
        evalChartEval.update();
        evalChartEvalHome.update();
    }

    function updateEventSaveModal(id){
        const event = eventList.find(g => g.id === id);
        document.querySelector("#saveEventModalTitle").textContent = "Edit Event Details";
        document.querySelector("#event-id-form").value =  event.id;
        document.querySelector("#event-label-form").value = event.label;
        document.querySelector("#event-description-form").value = event.description;
        document.querySelector("#event-date-form").value = event.date;
        document.querySelector("#event-red-form").value = event.color.red;
        document.querySelector("#event-green-form").value = event.color.green;
        document.querySelector("#event-blue-form").value = event.color.blue;
        updateEventColorPreview();
    }

    document.querySelector("#event-red-form").addEventListener('input', function() {
        updateEventColorPreview();
    });
    document.querySelector("#event-green-form").addEventListener('input', function() {
        updateEventColorPreview();
    });
    document.querySelector("#event-blue-form").addEventListener('input', function() {
        updateEventColorPreview();
    });

    function updateEventColorPreview(){
        const color = "rgb(" + document.querySelector("#event-red-form").value + "," + document.querySelector("#event-green-form").value + "," + document.querySelector("#event-blue-form").value + ")";
        console.log(color);
        document.querySelector("#event-color-preview").style.backgroundColor = color;
    }

    function modalSaveEvent(){
        const formData = {
            id: document.querySelector("#event-id-form").value,
            label: document.querySelector("#event-label-form").value,
            description: document.querySelector("#event-description-form").value,
            date: document.querySelector("#event-date-form").value,
            red: document.querySelector("#event-red-form").value,
            green: document.querySelector("#event-green-form").value,
            blue: document.querySelector("#event-blue-form").value
        };

        let toastId = createToast("Saving Event");
        postData("/api/interpersonal/event/save", formData)
            .then((message) => {
                document.getElementById(`${toastId}-body`).innerText = getIcon(message.severity) + message.message;
                document.getElementById(`${toastId}-title`).innerText =  message.title;
                document.getElementById(`${toastId}-loading`).style.color = "green";
            })
            .catch((response) => {
                console.log(response);
                response.json()
                    .then(errorData => {
                        document.getElementById(`${toastId}-body`).innerText = getIcon(errorData.severity) + errorData.message;
                        document.getElementById(`${toastId}-title`).innerText = errorData.title;
                        document.getElementById(`${toastId}-loading`).style.color = "red";
                    })
                    .catch(error => {
                        console.error("Error parsing error response:", error);
                        document.getElementById(`${toastId}-body`).innerText = "Unable to connect to Polariscope Online Services";
                        document.getElementById(`${toastId}-title`).innerText = "Error";
                        document.getElementById(`${toastId}-loading`).style.color = "red";
                    });
            })
            .finally(() => {refresh()});
    }

    function createEvalChart(){
        let canvas = document.querySelector("#evaluation-history-chart");
        let scores = {
            datasets: [{ data: [] }]
        };

        evalChartEval = new Chart(canvas, {
            type: 'line',
            data: scores,
            options: {
                aspectRatio: 5,
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    },
                },
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            unit: 'day',
                            displayFormats: {
                                day: 'MM/dd/yyyy'
                            }
                        }
                    }
                }
            }
        });

        let canvas2 = document.querySelector("#evaluation-history-chart-home");
        evalChartEvalHome = new Chart(canvas2, {
            type: 'line',
            data: scores,
            options: {
                aspectRatio: 3,
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            unit: 'day',
                            tooltipFormat: 'MM/dd/yyyy',
                            displayFormats: {
                                day: 'MM/dd/yyyy'
                            }
                        }
                    }
                }
            }
        });
    }
</script>
</body>
</html>