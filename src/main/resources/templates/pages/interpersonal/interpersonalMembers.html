<!DOCTYPE html>
<html xml:th="https://www.thymeleaf.org">
<head th:replace="~{components/Header :: head('Home')}"></head>
<body class="bg-2 text-1" data-bs-theme="dark">
<div th:replace="~{components/Navigation :: navigation}"></div>
<main class="container-fluid px-4 py-2">
    <nav class="navbar d-flex justify-content-between align-items-center">
        <div>
            <a href="/interpersonal">< Interpersonal Home</a>
        </div>
        <div>
            <h2 class="fw-bold text-center">All Members</h2>
        </div>
        <div></div>
    </nav>
    <div class="container table-responsive">
        <table class="table table-hover">
            <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">First</th>
                <th scope="col">Last</th>
                <th scope="col">Handle</th>
            </tr>
            </thead>
            <tbody id="table-body">

            </tbody>
        </table>
    </div>
</main>
<div th:replace="~{components/External :: external}"></div>
<div th:replace="~{components/Network :: network}"></div>
<div th:replace="~{components/External :: external}"></div>
<script>
    refresh();
    function refresh(){
        const memberListFetch = fetch("/api/interpersonal/member/all", {});
        Promise.all([memberListFetch])
            .then(responses => {
                return Promise.all([responses[0]]);
            })
            .then(data => {
                return Promise.all([data[0].json()]);
            })
            .then(data => {
                console.log(data[0]);
                let tableContents = '';
                data[0].forEach((member) => {
                    tableContents += `
                    <tr>
                        <th scope="row">1</th>
                        <td>${member.firstName} ${member.lastName}</td>
                        <td>${member.relationship}</td>
                        <td>${member.sex}</td>
                        <td>${member.sexuality}</td>
                        <td><a href="/interpersonal/member/view/${member.id}">View Member ></a></td>
                    </tr>
                    `;
                });
                document.querySelector("#table-body").innerHTML = tableContents;
            })
            .catch((response) => {
                console.log(response);
                response.json()
                    .then(errorData => {
                        console.log(errorData.message);
                    })
                    .catch(error => {
                        console.error("Error parsing error response:", error);
                    });
            })
    }
</script>
</body>
</html>